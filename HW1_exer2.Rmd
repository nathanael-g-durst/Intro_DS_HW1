---
title: "Financial Analysis"
date: "`r format(Sys.time(), '%d %B %Y')`"
author: "Adel Ben Snoussi, El-Amine Maamar, Eric Brandstätter, Nathanaël G. Dürst"
output: html_document
---

```{r, echo=F, results="hide", message=F, warning=F,}

#Load library
library("quantmod")
library("PerformanceAnalytics")

#List of the companies analyzed
tickerList = c("AAPL", "CSCO", "INTC", "HD", "GOOG", "JPM")

#Import data
getSymbols.yahoo(
  tickerList,
  env = globalenv(),
  from = "2020-01-01",
  to = "2021-01-01",
  periodicity = "daily"
)

#Plot AAPL's closing price
plot(AAPL$AAPL.Close)

#Plot CSCO's closing price
plot(CSCO$CSCO.Close)

#Candle chart GOOG 2020 Q4
candleChart(GOOG, subset = "2020-10/2020-12")

#Candle chart JPM 2020 Q4
candleChart(JPM, subset = "2020-10/2020-12")

#--------------- [START] Mean and Variance Loop ---------------#

########## This needs to be modified to use a matrix to store data (cleaner code on the recommendation of Lionel)

for (tickerName in tickerList) {

  #Variables' name generation
  varNameRe <- paste("returns",tickerName, sep = "")
  varNameMe <- paste("mean",tickerName, sep = "")
  varNameVa <- paste("var",tickerName, sep = "")

  #Computations
  returnsStock <- na.omit(ClCl(get(tickerName)))
  names(returnsStock) <- tickerName
  meanStock <- mean(returnsStock)
  varStock <- var(returnsStock)
  
  #Assigning values to their variables
  assign(varNameRe, returnsStock)
  assign(varNameMe, meanStock)
  assign(varNameVa, varStock)

}

#Cleaning environment after loop end
rm(returnsStock, varStock, meanStock, tickerName, varNameMe, varNameRe, varNameVa)

#--------------- [END] Mean and Variance Loop ---------------#

#--------------- [START] Sharpe ratio ---------------#

#Import data

getSymbols.yahoo(
  tickerList,
  env = globalenv(),
  from = "2011-01-01",
  to = "2021-01-01",
  periodicity = "daily"
)

#--------------- [START] Sharpe ratio Loop ---------------#

########## This needs to be modified to use a matrix to store data (cleaner code on the recommendation of Lionel)

for (tickerName in tickerList) {

  #Variables' name generation
  varNameS <- paste("sharpe",tickerName, sep = "")

  #Computations
  sharpeStock <- SharpeRatio.annualized(dailyReturn(get(tickerName)), Rf = 0.03/252, scale = 252)
  
  #Assigning values to their variables
  assign(varNameS, sharpeStock)

}

#Cleaning environment after loop end
rm(varNameS, sharpeStock, tickerName)

#--------------- [END] Sharpe ratio Loop ---------------#

#--------------- [END] Sharpe ratio ---------------#

#--------------- [START] Weighted portfolio - Uses the first set of data ---------------#

weightPortfolio <- rep((100/length(tickerList))/100, times = length(tickerList))

returnsAll <- NULL

for (tickerName in tickerList) {

  varNameRe <- paste("returns",tickerName, sep = "")
  returnsStock <- get(varNameRe)
  returnsAll <- merge.xts(returnsAll, returnsStock)

}

#Cleaning environment after loop end
rm(varNameRe, returnsStock, tickerName)

returnsPortfolio <- Return.portfolio(returnsAll, weights = weightPortfolio)
names(returnsPortfolio) <- "Portfolio"

varPortfolio <- var(returnsPortfolio)

#--------------- [END] Weighted portfolio ---------------#

#--------------- [START] Efficient frontier ---------------#


```